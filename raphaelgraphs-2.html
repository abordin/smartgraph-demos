<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Raphael graphs</title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/raphael/raphael.js"></script>
    <script type="text/javascript" src="javascripts/g-raphael/g.raphael.js"></script>
    <script type="text/javascript" src="javascripts/g-raphael/g.line.js" charset="utf-8"></script>
    
    <link type="text/css" charset="utf-8" rel="stylesheet" media="screen, projection" 
        href="stylesheets/apidocs.css" />
    <link rel="stylesheet" href="demo.css" type="text/css" media="screen" charset="utf-8">

    <script type="text/javascript">
        
        var f = function (x) { return ( -2.5 + 4 * x * x ); },
            xrange = { min: -5, max: 5 },
            xstep = 0.1,
            xaxis_steps = 10,
            yaxis_steps = 10,
            padding = { top: 20, right: 20, bottom: 20, left: 20 },
            txt = {font: '12px Fontin-Sans, Arial', fill: "#fff"},
            colorhue = .6,
            color = "hsb(" + [colorhue, 1, .75] + ")",
            snap_width = 50;


        var range = function (min, max, step) {
            var xs = [];
            var n_steps = Math.floor((max-min)/step)+1;  
                     
            for (var i = 0; i < n_steps; i++) {
                xs[i] = min + i*step;
            }
            
            return xs;
        };
        
        
        // evaluate f over xs
        var eval_func = function (f, xs) {
            var ys = [];

            for (var i = 0; i < xs.length; i++) {
                ys[i] = f(xs[i]);
            }
            
            return ys;
        };
        
        // handy utilities        
        var max = function (arr) { return Math.max.apply(null, arr); };
        var min = function (arr) { return Math.min.apply(null, arr); };
        
        
        $(document).ready(function () {

            var $container = $('#container');
            
            var r = Raphael("container"),
                canvas_width = $container.width(),
                canvas_height = $container.height(),
                plot_width = canvas_width - padding.left - padding.right,
                plot_height = canvas_height - padding.top - padding.bottom;

            var plot = function (r) {
                
                var xs = range(xrange.min, xrange.max, xstep);
                var ys = eval_func(f, xs);
                var yrange = { min: min(ys), max: max(ys) };
                
                xaxis_offset = plot_height *
                    ((yrange.min < 0 && yrange.max > 0) ? (yrange.max / (yrange.max - yrange.min)) : 1);
                    
                yaxis_offset = plot_width *
                    ((xrange.min < 0 && xrange.max > 0) ? (-xrange.min / (xrange.max - xrange.min)) : 0);
                    
                // make this a plain ol' path.
                

                //var chart = r.g.linechart(padding.left, padding.top, plot_width, plot_height, xs, ys);
                
                var xspacing = plot_width / (xrange.max - xrange.min);
                var yspacing = plot_height / (yrange.max - yrange.min);
                
                var pathspec = [];
                var pi = 0;
                
                for (var i = 0, ii = xs.length; i < ii; i++) {
                    var y = padding.top + Math.round(yspacing * (yrange.max - ys[i])),
                        x = padding.left + Math.round(xspacing * (xs[i] - xrange.min));
                        
                    pathspec[pi++] = (pi == 1) ? "M" : "L";
                    pathspec[pi++] = x;
                    pathspec[pi++] = ' ';
                    pathspec[pi++] = y;
                    //pathspec[pi++] = ' ';
                }
                //pathspec[pi] = "z";
                
                // draw the path
                var pathstr = pathspec.join('');
                var path = r.path(pathstr).attr({
                    stroke: color,
                    "stroke-width": 2,
                });
                
                var snap_path = r.path(pathstr).attr({
                    opacity: 0.0,
                    "stroke-width": snap_width
                });
                
                var point = r.circle(0, 0, 3).attr({
                    stroke: "#aa0000",
                    fill: "#aa0000"
                });
                
                
                point.attr({cx: plot_width/2 + padding.left, cy: plot_height/2 + padding.top});
                
                var point_is_selected = false;
                var point_location = { x: 0, y: 0 };
                
                $(snap_path.node).hover(function () {
                    var left = $container.offset().left
                    $(document).bind("mousemove.point_selection", function (e) {
                        var xloc = e.clientX - left;
                    
                        var xval = (xloc - padding.left) / xspacing + xrange.min
                        var yval = f(xval);
                        var yloc = padding.top + Math.round(yspacing * (yrange.max - yval));
                        
                        
                        point.attr({cx: xloc, cy: yloc}).show();
                    });
                    
                    $(document).bind("click.point_selection", function (e) {
                        point_location.x = e.clientX;
                        point_is_selected = true;
                    });
                }, function () {
                    
                    $(document).unbind(".point_selection");
                    if (!point_is_selected) {
                        point.hide();
                    }            
                });
                
                r.g.txtattr.font = "12px 'Fontin Sans', Fontin-Sans, sans-serif";
                
                // x axis
                r.g.axis(
                    padding.left, padding.top + xaxis_offset, plot_width, xrange.min, xrange.max, xaxis_steps, 2);

                // can we animate these when we switch between ranges?
                
                // y axis 
                r.g.axis(
                    padding.left + yaxis_offset, padding.top + plot_height, plot_height, yrange.min, yrange.max, yaxis_steps, 3);
            };
            
            plot(r);
        });
    </script>

</head>
<body> 
    <div id="main" class="page-content">
        <h3 class="page-title namespace">
            Raphael graphs
        </h3>
        <div id="back" class="back">
            <a href="index.html">back</a>
        </div>
        <div class="section section-klass_methods">
            <div class="section-content">
                <ul class="method-details-list">
                    <li class="method-description">
                        <form id="math" action="#">
                            <fieldset>
                                <legend>Simple graph: </legend>
                                <label>y = </label>
                                <input type="text" id="exp" value="-2.5 + 4 * x * x" /><br /><br />
                                <input type="button" value="plot" onclick="plotIt([0,0]);" />
                            </fieldset>
                            <fieldset>
                                <legend>Question: </legend>
                                <p>Click on the graph where the y value is less than zero.</p>
                                <input type="button" value="Check Answer" onclick="checkAnswer();" />
                            </fieldset>
                        </form>
                        <div id="container" style="width:600px;height:300px;"></div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>