Nodelink=SC.Application.create({NAMESPACE:"Nodelink",VERSION:"0.1.0",store:SC.Store.create().from(SC.Record.fixtures)});if(typeof CHANCE_SLICES==="undefined"){var CHANCE_SLICES=[]}CHANCE_SLICES=CHANCE_SLICES.concat([]);Nodelink.LinkView=RaphaelViews.RaphaelView.extend({displayProperties:"content.endNode.x content.endNode.y content.startNode.x content.startNode.y lineColor borderColor borderOpacity lineWidth borderWidth".w(),lineColor:"#0000AA",borderColor:"#FFFF00",borderOpacity:function(){return this.get("isSelected")?1:0}.property("isSelected"),lineWidth:3,borderWidth:3,renderCallback:function(c,b,a){return c.set().push(c.path().attr(a),c.path().attr(b))},render:function(b,a){var i=this.get("content"),c=i.get("startNode"),h=i.get("endNode"),g=c.get("x"),f=c.get("y"),m=h.get("x"),l=h.get("y"),o=["M",g+25,f+25,"L",m+25,l+25].join(" "),k={path:o,stroke:this.get("borderColor"),opacity:this.get("borderOpacity"),"stroke-width":this.get("lineWidth")+2*this.get("borderWidth"),"stroke-linecap":"round"},d={path:o,stroke:this.get("lineColor"),"stroke-width":this.get("lineWidth"),"stroke-linecap":"round"},j,e,n;if(a){b.callback(this,this.renderCallback,d,k)}else{j=this.get("raphaelObject");e=j.items[0];n=j.items[1];e.attr(k);n.attr(d)}}});sc_require("views/link_view");Nodelink.Link=SC.Record.extend({startNode:SC.Record.toOne("Nodelink.Node",{inverse:"outLinks",isMaster:YES}),endNode:SC.Record.toOne("Nodelink.Node",{inverse:"inLinks",isMaster:YES}),exampleView:Nodelink.LinkView});Nodelink.NodeView=RaphaelViews.RaphaelView.extend(SC.ContentDisplay,{contentDisplayProperties:"x y".w(),displayProperties:"bodyColor borderColor borderOpacity bodyWidth bodyHeight borderWidth".w(),isSelected:NO,isDragging:NO,bodyColor:"#CCCCCC",borderColor:function(){return this.get("isSelected")?"#FFFF00":"#AAAAAA"}.property("isSelected"),borderOpacity:1,bodyWidth:50,bodyHeight:50,borderWidth:function(){return this.get("isSelected")?4:2}.property("isSelected"),collectionView:function(){var a=this.get("parentView");if(a&&a.kindOf&&a.kindOf(SC.CollectionView)){return a}else{a=a.get("parentView");if(a&&a.kindOf&&a.kindOf(SC.CollectionView)){return a}else{return null}}}.property("parentView").cacheable(),renderCallback:function(b,a){return b.rect().attr(a)},render:function(c,g){var e=this.get("content"),a=e.get("x"),f=e.get("y"),b={x:a,y:f,r:5,width:this.get("bodyWidth"),height:this.get("bodyHeight"),fill:this.get("bodyColor"),stroke:this.get("borderColor"),"stroke-width":this.get("borderWidth"),"stroke-opacity":this.get("borderOpacity")},d;if(g){c.callback(this,this.renderCallback,b)}else{d=this.get("raphaelObject");d.attr(b)}},mouseDown:function(a){this.startDrag(a);return YES},mouseDragged:function(a){this.drag(a);return YES},mouseUp:function(a){this.endDrag(a);return YES},startDrag:function(a){this.$().css("cursor","move");this.set("isDragging",YES);this._dragX=a.pageX;this._dragY=a.pageY;this._mouseDownEvent=a;this._didDragBody=NO},drag:function(b){var c=this.get("content"),a=c.get("x")+b.pageX-this._dragX,d=c.get("y")+b.pageY-this._dragY;if(!this.get("isDragging")){return}if(a<this.get("borderWidth")){a=this.get("borderWidth")}if(a+this.get("bodyWidth")>this.getPath("parentView.width")+this.getPath("parentView.borderWidth")){a=this.getPath("parentView.width")+this.getPath("parentView.borderWidth")-this.get("bodyWidth")}if(d<this.get("borderWidth")){d=this.get("borderWidth")}if(d+this.get("bodyHeight")>this.getPath("parentView.height")+this.getPath("parentView.borderWidth")){d=this.getPath("parentView.height")+this.getPath("parentView.borderWidth")-this.get("bodyHeight")}c.set("x",a);c.set("y",d);this._dragX=b.pageX;this._dragY=b.pageY;this._didDragBody=YES},endDrag:function(a){var b=this.get("collectionView");if(!this._didDragBody){b.mouseDown(this._mouseDownEvent);b.mouseUp(a)}this.drag(a);this.$().css("cursor","default");this.set("isDragging",NO)}});sc_require("views/node_view");Nodelink.Node=SC.Record.extend({x:SC.Record.attr(Number),y:SC.Record.attr(Number),outLinks:function(){return this.get("store").find(SC.Query.local(Nodelink.Link,"startNode.id = '%@'".fmt(this.get("id"))))}.property("id").cacheable(),inLinks:function(){return this.get("store").find(SC.Query.local(Nodelink.Link,"endNode.id = '%@'".fmt(this.get("id"))))}.property("id").cacheable(),exampleView:Nodelink.NodeView});sc_require("models/link_model");sc_require("models/node_model");Nodelink.diagramController=SC.ArrayController.create({nodes:function(){return Nodelink.store.find(Nodelink.Node)}.property(),links:function(){return Nodelink.store.find(Nodelink.Link)}.property(),startUpdatingContent:function(){this.addObserver("nodes.[]",this,this.updateContentOnce);this.addObserver("links.[]",this,this.updateContentOnce);this.updateContent()},updateContentOnce:function(){this.invokeOnce(this.updateContent)},updateContent:function(){this.set("content",SC.A(this.get("nodes")).concat(SC.A(this.get("links"))))}});sc_require("models/link_model");Nodelink.Link.FIXTURES=[{guid:"link1",startNode:"node1",endNode:"node2"}];sc_require("models/node_model");Nodelink.Node.FIXTURES=[{guid:"node1",x:100,y:100},{guid:"node2",x:200,y:100}];Nodelink.Theme=SC.AceTheme.create({name:"nodelink"});SC.Theme.addTheme(Nodelink.Theme);SC.defaultTheme="nodelink";Nodelink.RectView=RaphaelViews.RaphaelView.extend(SC.ContentDisplay,{displayProperties:"x y width height cornerRadius bodyColor borderColor borderWidth bodyOpacity".w(),x:0,y:0,width:0,height:0,cornerRadius:0,bodyColor:"#FFFFFF",borderColor:"#FFFFFF",borderWidth:0,borderOpacity:1,bodyOpacity:1,renderCallback:function(b,a){return b.rect().attr(a)},render:function(c,e){var a=this.get("borderWidth"),b={x:this.get("x")+a,y:this.get("y")+a,width:this.get("width"),height:this.get("height"),r:this.get("cornerRadius"),fill:this.get("bodyColor"),stroke:this.get("borderColor"),"stroke-width":a,"stroke-opacity":this.get("borderOpacity"),"fill-opacity":this.get("bodyOpacity")},d;if(e){c.callback(this,this.renderCallback,b)}else{d=this.get("raphaelObject");d.attr(b)}this.renderChildViews(c,e)}});Nodelink.mainPage=SC.Page.design({mainPane:SC.MainPane.design({childViews:"raphaelCanvasView".w(),raphaelCanvasView:RaphaelViews.RaphaelCanvasView.design({layout:{top:20,left:20,width:404,height:304},childViews:"diagramView".w(),diagramView:RaphaelViews.RaphaelCollectionView.design({contentBinding:"Nodelink.diagramController.arrangedObjects",contentExampleViewKey:"exampleView",selectOnMouseDown:NO,childViews:"containerView".w(),containerView:Nodelink.RectView.design({cornerRadius:5,width:400,height:300,borderColor:"#CCCCCC",borderWidth:2}),mouseDown:function(a){if(!this.itemViewForEvent(a)){this.select(null)}arguments.callee.base.apply(this,arguments)}})})})});Nodelink.main=function main(){Nodelink.diagramController.startUpdatingContent();Nodelink.getPath("mainPage.mainPane").append()};function main(){Nodelink.main()};